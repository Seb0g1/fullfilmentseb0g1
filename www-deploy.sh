#!/bin/bash

# –£–ø—Ä–æ—â–µ–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞–∑–º–µ—â–µ–Ω–∏—è –≤ /www
# –≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç –º–æ–∂–Ω–æ —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å –≤ /www –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å –æ—Ç—Ç—É–¥–∞
# –û–Ω –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –Ω–∞–π–¥–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç –¥–µ–ø–ª–æ–π

set -e

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é —Å–∫—Ä–∏–ø—Ç–∞
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_DIR="/var/www/sakoo.ru"

echo "=========================================="
echo "üöÄ –î–µ–ø–ª–æ–π —Å–∞–π—Ç–∞ fulfillment"
echo "=========================================="
echo ""
echo "–°–∫—Ä–∏–ø—Ç –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤: ${SCRIPT_DIR}"
echo "–ü—Ä–æ–µ–∫—Ç –±—É–¥–µ—Ç —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –≤: ${PROJECT_DIR}"
echo ""

# –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –∑–∞–ø—É—â–µ–Ω –Ω–µ –∏–∑ /var/www/sakoo.ru, –ø–µ—Ä–µ—Ö–æ–¥–∏–º —Ç—É–¥–∞
if [ "$SCRIPT_DIR" != "$PROJECT_DIR" ]; then
    echo "–ü–µ—Ä–µ—Ö–æ–¥ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞..."
    mkdir -p "${PROJECT_DIR}"
    cd "${PROJECT_DIR}"
    
    # –ï—Å–ª–∏ —ç—Ç–æ –ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫, –∫–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
    if [ ! -d ".git" ]; then
        echo "–ö–ª–æ–Ω–∏—Ä—É—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π..."
        git clone https://github.com/Seb0g1/fullfilmentseb0g1.git .
    fi
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º –ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –¥–µ–ø–ª–æ—è
if [ -f "deploy-full.sh" ]; then
    chmod +x deploy-full.sh
    sudo ./deploy-full.sh
elif [ -f "${SCRIPT_DIR}/deploy-full.sh" ]; then
    # –ï—Å–ª–∏ —Å–∫—Ä–∏–ø—Ç –≤ –¥—Ä—É–≥–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏, –∫–æ–ø–∏—Ä—É–µ–º –µ–≥–æ
    cp "${SCRIPT_DIR}/deploy-full.sh" .
    chmod +x deploy-full.sh
    sudo ./deploy-full.sh
else
    echo "–û—à–∏–±–∫–∞: deploy-full.sh –Ω–µ –Ω–∞–π–¥–µ–Ω!"
    echo "–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ñ–∞–π–ª deploy-full.sh –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏"
    exit 1
fi

